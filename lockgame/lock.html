<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <style>
div.lock {
    display: grid;
    grid-template-columns: 70px 70px 70px 70px 70px 70px;
    grid-template-rows: 70px 70px 70px 70px 70px 70px;
    -ms-touch-action: none;
    touch-action: none;
}
div.cell {
    display: grid;
    grid-template-columns: 20px 20px 20px;
    grid-template-rows: 20px 20px 20px;
    border: 2px solid #888888;
    height: 60px;
    width: 60px;
    background-color: #444444;
    border-radius: 10px;
    overflow: hidden;
}
div.cell.selected {
    background-color: #446644;
}
div.cell.target {
    background-color: #444466 !important;
}
div.side {
    background-color: #666666;
}
div.cell div,
div.side div {
    background-color: #aaaaaa;
}
div.cell div.mm,
div.side div.mm {
    background-color: inherit;
}
div.side.left div.mr,
div.side.right div.ml,
div.side.bottom div.tm,
div.side.top div.bm {
    background-color: inherit;
}
div.side.top.left,
div.side.top.right,
div.side.bottom.left,
div.side.bottom.right {
    background-color: inherit;
    border: 0;
}
div.side.top.left div,
div.side.top.right div,
div.side.bottom.left div,
div.side.bottom.right div {
    background-color: inherit;
    border: 0;
}

div.cell.tl div.tm,
div.cell.tl div.ml {
    background-color: inherit;
}
div.cell.tr div.tm,
div.cell.tr div.mr {
    background-color: inherit;
}
div.cell.bl div.bm,
div.cell.bl div.ml {
    background-color: inherit;
}
div.cell.br div.bm,
div.cell.br div.mr {
    background-color: inherit;
}
div.cell.tb div.tm,
div.cell.tb div.bm {
    background-color: inherit;
}
div.cell.lr div.ml,
div.cell.lr div.mr {
    background-color: inherit;
}
div.cell.tlr div.tm,
div.cell.tlr div.ml,
div.cell.tlr div.mr {
    background-color: inherit;
}
div.cell.blr div.bm,
div.cell.blr div.ml,
div.cell.blr div.mr {
    background-color: inherit;
}
div.cell.tbl div.tm,
div.cell.tbl div.bm,
div.cell.tbl div.ml {
    background-color: inherit;
}
div.cell.tbr div.tm,
div.cell.tbr div.bm,
div.cell.tbr div.mr {
    background-color: inherit;
}
div.cell.tblr div.tm,
div.cell.tblr div.bm,
div.cell.tblr div.ml,
div.cell.tblr div.mr {
    background-color: inherit;
}


div.cell.red {
    background-color: #ff4444;
}
div.cell.green {
    background-color: #44ff44;
}
div.cell.blue {
    background-color: #4488ff;
}
div.cell.red.green {
    background-color: #ffff44;
}
div.cell.red.blue {
    background-color: #cc44ff;
}
div.cell.green.blue {
    background-color: #44ffff;
}
div.cell.red.green.blue {
    background-color: #ffffff;
}

    </style>
    <link rel="stylesheet" src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.10.4/themes/cupertino/jquery-ui.css">
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.10.4/jquery-ui.min.js"></script>
    <script type="text/javascript">
var wid = 4;
var hei = 4;
var cellgrid = [];
/*
var tiles = [
    '',     '',   '',   'red','',    '',
    'green','tl', 'tb', 'tb', 'br',  '',
    'blue', 'bl', 'tb', 'tbr','tl',  '',
    '',     'tl', 'tr', 'tbl','br',  'green',
    '',     'br', 'lr', 'tl', 'tr',  '',
    '',     'red','',   '',   'blue',''
    ]
    */
var tiles = [
    '   R  ',
    'G╝║║╔ ',
    'B╗║╠╝ ',
    ' ╝╚╣╔G',
    ' ╔═╝╚ ',
    ' R  B ',
];
var tilechars = {
    '═': 'lr',  // 2550 lr
    '║': 'tb',  // 2551 tb
    '╔': 'br',  // 2554 br
    '╗': 'bl',  // 2557 bl
    '╚': 'tr',  // 255a tr
    '╝': 'tl',  // 255d tl
    '╠': 'tbr', // 2560 vr
    '╣': 'tbl', // 2563 vl
    '╦': 'blr', // 2566 hb
    '╩': 'tlr', // 2569 ht
    '╬': 'tblr', // 256c hv
    'R': 'red',
    'G': 'green',
    'B': 'blue'
};

$(function() {
    var html = [];
    var indiv = '<div class="tl"></div><div class="tm"></div><div class="tr"></div>'+
                '<div class="ml"></div><div class="mm"></div><div class="mr"></div>'+
                '<div class="bl"></div><div class="bm"></div><div class="br"></div>';
    for (var y = 0; y < hei+2; y++) {
        var clsy = '';
        if (y == 0) clsy = 'top side';
        if (y == (hei+1)) clsy = 'bottom side';
        for (var x = 0; x < wid+2; x++) {
            var clsx = '';
            if (x == 0) clsx = 'left side';
            if (x == (wid+1)) clsx = 'right side';
            html.push('<div class="cell ',clsx,' ',clsy,' row_',y,' col_',x,'">',indiv,'</div>');
        }
    }
    $('#lock').html(html.join(''));
    $('#lock').on('click', 'div.cell:not(.side)', click_cell);
    $('#lock div.cell:not(.side)').draggable({
        containment: 'parent'
        ,opacity: 0.6
        ,start: start_cell
        ,stop: stop_cell
        ,drag: move_cell
        ,revert: drop_cell
        ,revertDuration: 250
        ,zIndex: 10
        ,distance: 10
    });

    for (var y = 0; y < hei+2; y++) {
        cellgrid[y] = [];
        for (var x = 0; x < wid+2; x++) {
            cellgrid[y][x] = $('#lock div.col_'+x+'.row_'+y);
        }
    }
    for (var y = 0; y < hei+2; y++) {
        for (var x = 0; x < wid+2; x++) {
            var tl = tilechars[tiles[y][x]];
            if (tl) { cellgrid[y][x].addClass(tl); }
        }
    }
    color_cells();
});
var rotates = {
    tl: 'tr',
    tr: 'br',
    br: 'bl',
    bl: 'tl',
    tb: 'lr',
    lr: 'tb',
    tlr: 'tbr',
    tbr: 'blr',
    blr: 'tbl',
    tbl: 'tlr',
    tblr: 'tblr'
};
var toplist    = ['tl','tr','tb','tlr','tbr','tbl','tblr','bottom'];
var bottomlist = ['bl','br','tb','blr','tbr','tbl','tblr','top'];
var leftlist   = ['tl','bl','lr','tlr','blr','tbl','tblr','right'];
var rightlist  = ['tr','br','lr','tlr','blr','tbr','tblr','left'];

function hasclasslist(cell, list) {
    for (i = list.length; --i >= 0; ) {
        if (cell.hasClass(list[i])) { return true; }
    }
    return false;
}

function get_type(elem) {
    for (var tp in rotates) {
        if (elem.hasClass(tp)) {
            return tp;
        }
    }
}
function start_cell(ev, ui) {
    ui.helper.addClass('selected');
    color_cells();
}
function stop_cell(ev, ui) {
    $('#lock div.cell.selected').removeClass('selected');
    $('#lock div.cell.target').removeClass('target');
    color_cells();
}
function move_cell(ev, ui) {
    var x = Math.round(ui.offset.left / 70);
    var y = Math.round(ui.offset.top / 70);
    if (x < wid+2 && y < hei+2) {
        var other = cellgrid[y][x].not('.side');
        if (other.length == 1) {
            if (!other.hasClass('target')) {
                $('#lock .target').removeClass('target');
                other.addClass('target');
            }
        } else {
                $('#lock .target').removeClass('target');
        }
    }
}
function drop_cell() {
    var other = $('#lock div.cell.target');
    if (other.length == 1) {
        var celltype = get_type(this);
        var othertype = get_type(other);
        this.removeClass(celltype).addClass(othertype);
        other.removeClass(othertype).addClass(celltype);
        color_cells();
        this.removeClass('selected').addClass('target');
        other.removeClass('target').addClass('selected');
    }
    return true;
}
function click_cell(ev) {
    if (ev.button != 0) return;
    var elem = $(this);
    var tp = get_type(elem);
    if (tp) { elem.removeClass(tp).addClass(rotates[tp]); }
    color_cells();
}
function down_cell(ev) {
    if (ev.button != 0) return;
    $('#lock div.cell.selected').removeClass('selected');
    $(this).addClass('selected');
    $('#lock').addClass('selected');
}
function up_cell(ev) {
    if (ev.button != 0) return;
    var elem = $(this);
    if (elem.hasClass('selected')) {
        var tp = get_type(elem);
        if (tp) { elem.removeClass(tp).addClass(rotates[tp]); }
    } else {
        var sel = $('#lock div.cell.selected');
        if (sel.length == 1) {
            var seltp = get_type(sel);
            var elemtp = get_type(elem);
            sel.removeClass(seltp).addClass(elemtp);
            elem.removeClass(elemtp).addClass(seltp);
        }
    }
    $('#lock div.cell.selected').removeClass('selected');
    $('#lock').removeClass('selected');
    color_cells();
}

function color_spread(cell, color, celllist, otherlist, x, y) {
    if (hasclasslist(cell, celllist)) {
        var other = cellgrid[y][x].not('.side').not('.'+color).not('.selected');
        if (hasclasslist(other, otherlist)) {
            other.addClass(color);
            color_cell(other, color);
            // setTimeout(function() { color_cell(other, color); }, 25);
        }
    }
}

function color_cell(cell, color) {
    cell.each(function() {
        var m = this.className.match(/row_([0-9]+)/)
        if (m) {
            var y = parseInt(m[1]);
            m = this.className.match(/col_([0-9]+)/)
            if (m) {
                var x = parseInt(m[1]);
                color_spread($(this), color, toplist, bottomlist, x, y-1);
                color_spread($(this), color, bottomlist, toplist, x, y+1);
                color_spread($(this), color, leftlist, rightlist, x-1, y);
                color_spread($(this), color, rightlist, leftlist, x+1, y);
            }
        }
    });
}

function color_cells(color) {
    if (!color) {
        color_cells('red');
        color_cells('green');
        color_cells('blue');
        return;
    }
    $('#lock div.cell:not(.side)').removeClass(color);
    color_cell($('#lock div.cell.side.'+color), color);
}

    </script>
    </head>
    <body>
        <div class="lock" id="lock">
        </div>
        <div class="text">
            <p>Proof of concept voor een kleine console om fysiek een futuristisch slot te openen.
            Soortement van pipe-mania, waarbij langs de zijkant in/uitgangen zijn met LEDs er achter waarvan er sommige oplichten.
            In het midden zitten dan blokjes die verplaatst kunnen worden (en geroteerd) om er voor te zorgen dat de juiste kleuren met elkaar zijn verbonden.
            </p>
            <p>
            Deze POC is om te kijken of dit een leuke puzzel oplevert, en hoe het eea. precies kan worden geprogrammeerd
            </p>
        </div>
    </body>
</html>
<!--
vim: ai:si:expandtab:ts=4:sw=4
-->
