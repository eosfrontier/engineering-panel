<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <script type="text/javascript">
var wid = 80;
var hei = wid * 0.866;
var side = 2;
var offX = 10;
var offY = 30;

var cellgrid = [];

function draw_triangle(g, x, y, size, color) {
    g.beginPath();
    g.moveTo(x,y);
    g.lineTo(x-size*0.5,y+size*0.866);
    g.lineTo(x+size*0.5,y+size*0.866);
    g.closePath();
    g.fillStyle = color;
    g.fill();
    g.stroke();
}

// Coordinaten raster maken
//
//        --------
// 1     /\ 3/\ 5/\
// 1    / 2\/ 4\/ 6\
//      ------------
// 2   /\ 2/\ 4/\ 6/\
// 2  / 1\/ 3\/ 5\/ 7\
//    ----------------
// 3  \ 1/\ 3/\ 5/\ 7/
// 3   \/ 2\/ 4\/ 6\/
//      ------------
// 4    \ 2/\ 4/\ 6/
// 4     \/ 3\/ 5\/
//        --------
//
// Dus verbonden met x,y:
//   als x+y even:   x-1,y | x+1,y | x,y-1
//   als x+y oneven: x-1,y | x+1,y | x,y+1

var colors = [
    '#f00',
    '#00f',
    '#0f0'
];
function init_grid() {
    cellgrid[-1] = [];
    cellgrid[2*side] = [];
    for (var row = 0; row < 2*side; row++) {
        cellgrid[row] = [];
        var cut = (Math.abs(row-side+0.5)-0.5);
        for (var col = cut; col < (4*side)-1-cut; col++) {
            cellgrid[row][col] = {color: 0};
        }
    }
    $('#lock').on('click', click_grid);
    draw_grid();
}

function click_grid(ev)
{
    /* Berekenen welke driehoek geklikt is */
    var posX = ev.offsetX-offX;
    var posY = ev.offsetY-offY;
    var crdY = Math.floor(posY/hei);
    var crdX = Math.floor(posX/wid);
    var insX = posX - crdX*wid - (wid/2);
    var insY = posY - crdY*hei;
    crdX *= 2;
    if (!(crdY % 2)) { insY = hei-insY; }
    if (insX < -(insY / 1.732)) { crdX -= 1;}
    if (insX >  (insY / 1.732)) { crdX += 1; }

    /* Driehoek van kleur veranderen */
    if (cellgrid[crdY][crdX]) {
        var cells = [cellgrid[crdY][crdX], cellgrid[crdY][crdX-1], cellgrid[crdY][crdX+1]];
        if ((crdX+crdY) % 2) {
            cells.push(cellgrid[crdY+1][crdX]);
        } else {
            cells.push(cellgrid[crdY-1][crdX]);
        }
        for (var i = 0; i < 4; i++) {
            if (cells[i]) {
                var col = cells[i].color;
                cells[i].color = (col+1) % colors.length;
            }
        }
        draw_grid();
    }
}

function draw_grid() {
    var canvas = document.getElementById('lock');
    var g = canvas.getContext("2d");
    g.clearRect(0, 0, canvas.width, canvas.height);
    g.lineJoin = 'round';
    g.lineWidth = 8;
    g.strokeStyle = '#000';
    for (var row = 0; row < 2*side; row++) {
        var cut = (Math.abs(row-side+0.5)-0.5);
        for (var col = cut; col < (4*side)-1-cut; col++) {
            var ypos = row*hei;
            var size = -wid;
            if ((row+col+side) % 2) {
                size = wid;
            } else {
                ypos += hei;
            }
            draw_triangle(g, (col+1)*wid/2+offX, ypos+offY, size, colors[cellgrid[row][col].color]);
        }
    }
}

$(init_grid);

    </script>
    <style>
body {
    background-color: #555555;
    color: #aaaacc;
}
div.lock {
    -ms-touch-action: none;
    touch-action: none;
    border: 20px solid #660000;
    border-radius: 70px;
    margin: 5px;
    width: 344px;
    height: 344px;
    overflow: hidden;
    background-color: #222222;
    padding: 16px;
    float: left;
}
div.lock.open {
    border-color: #009900;
}
    </style>
    </head>
    <body>
        <div class="lock">
            <canvas id="lock" width="344" height="344">
            </canvas>
        </div>
        <div id="message">Start</div>
        <div id="type">Type: <span id="gametype"></span></div>
        <div class="text">
            <p>Proof of concept voor een kleine console om fysiek een futuristisch slot te openen.
            Soort van lights-out, met een raster van driehoekige knoppen met led-pixels er achter die op een knopdruk zelf van kleur veranderen maar ook naastliggende cellen van kleur doen veranderen.
            </p>
            <p>
            Deze POC is om te kijken of dit een leuke puzzel oplevert, en hoe het eea. precies kan worden geprogrammeerd
            </p>
        </div>
    </body>
</html>
<!--
vim: ai:si:expandtab:ts=4:sw=4
-->
